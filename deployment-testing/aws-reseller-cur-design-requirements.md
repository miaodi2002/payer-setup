# AWS代理商CUR数据设计需求文档

## 业务背景

**公司角色**: AWS代理商  
**业务模式**: 向客户提供AWS服务并应用自定义折扣  
**数据需求**: 需要两套独立的CUR数据来支持不同的业务用途  

## 🎯 核心业务需求

### 业务流程概述
1. **代理商**从AWS获得真实成本数据 (包含代理商折扣/credit/RISP利润)
2. **代理商**向客户展示AWS标准价格作为"原价"
3. **代理商**通过自己的帐单系统对"原价"应用自定义折扣
4. **客户**看到的是: AWS原价 → 代理商折扣 → 最终价格

## 📊 两套CUR数据需求

### CUR 1: Pro forma CUR (客户可见数据)
**业务用途**: 向客户展示的"AWS原价"基准
**技术目标**: 获得AWS标准列表价格，不含任何代理商折扣
**数据流向**: Pro forma CUR → Athena → 代理商帐单系统 → 应用自定义折扣 → 客户账单
**客户视角**: 客户看到"AWS原价"和代理商提供的折扣

**核心要求**:
- ✅ 必须显示AWS标准价格
- ✅ 不能包含代理商折扣
- ✅ 客户可见数据
- ✅ 用作折扣计算基准

### CUR 2: RISP CUR (代理商内部数据)
**业务用途**: 代理商实际向AWS支付的真实成本数据
**技术目标**: 获得包含所有代理商优惠的真实费用
**数据流向**: RISP CUR → 代理商内部分析 → 利润计算和成本分析
**保密性**: 客户绝对不能看到此数据

**核心要求**:
- ✅ 必须包含代理商折扣
- ✅ 必须包含Credit抵扣
- ✅ 必须包含RISP利润
- ✅ 代理商真实成本数据
- 🔒 高度保密，客户不可见

## 🔍 当前技术问题分析

### 发现的配置问题
1. **Pro forma CUR**: ✅ 正确配置 - 使用billing-group-1753182274
2. **RISP CUR**: ❌ 配置错误 - 意外使用Primary billing view

### 问题详细分析
```
期望的RISP CUR配置: 无BillingViewArn (获得真实代理商成本)
实际的RISP CUR配置: Primary billing view (可能影响真实成本数据)
```

### 业务影响
- **成本分析偏差**: 可能无法获得准确的代理商真实成本
- **利润计算错误**: 影响内部财务分析的准确性
- **决策数据不准**: 基于错误数据的业务决策

## 🎯 明确的技术需求

### Pro forma CUR需求
- **Billing Group**: 使用无折扣的billing group (显示AWS标准价格)
- **价格类型**: AWS官方列表价格
- **用途**: 客户可见的"原价"基准

### RISP CUR需求
- **Billing View**: 不使用任何Billing Group
- **价格类型**: 代理商实际向AWS支付的真实成本
- **包含**: 所有代理商优惠、折扣、credit等
- **用途**: 内部成本分析和利润计算

## 📋 设计验证标准

### Pro forma CUR验证标准
- [ ] 客户账号正确关联billing group
- [ ] 价格为AWS标准列表价格
- [ ] 不包含代理商特殊折扣
- [ ] 可用作客户账单的原价基准

### RISP CUR验证标准
- [ ] 不关联任何Billing Group
- [ ] 包含代理商实际支付的所有费用
- [ ] 包含代理商折扣和credit
- [ ] 数据保密性得到保障

## 🔧 下一步行动计划
1. **技术实现方案设计** - 基于业务需求设计具体技术方案
2. **方案Review** - 确保技术方案符合业务需求
3. **实施和测试** - 部署正确的配置并验证数据准确性
4. **数据验证** - 确认两套CUR数据符合预期

---
**文档状态**: 需求确认完成，等待技术实现方案